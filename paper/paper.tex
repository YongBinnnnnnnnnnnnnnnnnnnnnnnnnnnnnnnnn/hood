\documentclass[mscthesis]{usiinfthesis}
\usepackage{lipsum}


\usepackage{listings}

\lstdefinelanguage{algebra}
{morekeywords={import,sort,constructors,observers,transformers,axioms,if,
else,end},
sensitive=false,
morecomment=[l]{//s},
}



\title{Design and implementation of a firewall device with a new method to harden SSL introduced} %compulsory
\mastermajor{Financial Technology and Computing}%optional
\specialization{main track}
%\subtitle{Subtitle: Reinventing the World} %optional 
\author{Bin Yong} %compulsory
\begin{committee}
\advisor{Prof.}{Student's}{Advisor} %compulsory
\coadvisor{Prof.}{Student's}{Co-Advisor}{} %optional
\end{committee}
\Day{Yesterday} %compulsory
\Month{September} %compulsory
\Year{2023} %compulsory, put only the year
\place{Lugano} %compulsory

%\dedication{To my beloved} %optional
%\openepigraph{Someone said \dots}{Someone} %optional

%\makeindex %optional, also comment out \theindex at the end

\begin{document}

\maketitle %generates the titlepage, this is FIXED

\frontmatter %generates the frontmatter, this is FIXED

\begin{abstract}
  Design and implementation of a firewall device based on Raspberry Pi.
  The firewall will use a new method to harden the SSL protocol. It is 
  designed for someone who would like to sacrifice some compatibility 
  to pursue better security but still wants some balance between 
  security and convenience. A sensitive target, like an investigative 
  journalist, could be a potential user of this device. The new method
  to enhance SSL security introduced in this article is widely 
  applicable to firewall designs.

\end{abstract}

\begin{acknowledgements}
  This document is a draft version of a working thesis of Bin Yong.
\end{acknowledgements}

\tableofcontents 
\listoffigures %optional
\listoftables %optional

\mainmatter

\chapter{Introduction}
The goal of this work is to increase the chance of survival of the user 
from hacking, evasdropping, and digital fingerprinting. The device will 
work as a strict firewall which limits network activities and will also
apply privacy enhancing technologies to reduce the attack surface of 
digital fingerprinting and it will also apply emerging technologies to 
increase the difficulty of eavesdropping. The device will run a SSL proxy 
to harden SSL protocol. It will use a screen to display selected real-time 
internet activities.\par
Using a hardware as a firewall has several advantages. Firstly, hardware 
firewall can provide complete isolation between highly unsafe code, 
like a browser, and firewall software (fun fact: I was hacked repeatedly 
through personally harddened latest version of firefox while writing this 
thesis). This could also work as a mitigation of CPU/BIOS level threats: 
Firmware malwares, bootkits, and doubtable proprietray technologies like 
Intel ME and the AMD PSP. Second, it will also provide convenience to the 
user: the configuration of this portable device will be applied to protect 
everything behind it, so people do not need to do the time consuming 
configuration work on different softwares and operating systems one by one. \par
Even things that could not be configured will be under the restriction of the firewall. In example, people cannot untrust a built-in trusted root certificate from iPhone via Settings app.



\chapter{Comparsion to existing works}
\section{Commercial hardware}
Commercial firewalls are expensive. In switzerland, the price of a entry 
level firewall is more than twice of a raspberry pi. Raspberry Pi being
used in this work could be replaced with some cheaper alternatives, making 
the cost will be even lower. Commercial firewalls also do not provide a 
screen to display network activities in real-time.

\section{SSL proxy}
Unlike traditional MITM SSL proxy, the proxy used in this device will work 
in non-intrusive way which means it will not decrypt SSL sessions.

\chapter[Design]{Design}

\section{Linux vs. BSD}

Due to its security-focused nature, OpenBSD would be a great choice when buiding a firewall. However, as a portable device, it is designed to work as a USB network device but OpenBSD does not contain a device mode in its USB stack. Linux provides USB gadget mode. Using the combination of ECM and RNDIS mode, most of Linux, Windows, BSD and MacOS could be supported. FreeBSD USB stack can run in device mode and provided 3 virtual network iterface templates but none of them works with Microsoft Windows\citet{freebsdhb:usb}. Considering the large market share of Microsoft Windows, linux is decided as the base OS of this firewall device.

\section{SSL Proxy}

The proxy will only work on SSL handshake packets. It will check weak algorithms from ClientHello and ServerHello if the negotiation result could not use a strong algorithm, the connection will be blocked. Altering handshake packets without MITM is not viable because the HMAC of all handshake packets are being used for encryption. The key share extension also make the certificate invisible to the proxy. Thus, in order to do certificate filtering, the proxy will negotiate with remote server with a sepearate connection to check the certificate being used by the remote host.

\section{Disguise and randomizatoin}

The device disguises itself as other common devices. It will generate random hostname and MAC address on startup so when local network administrators check their the DHCP server they will always see different device information being recorded.

\chapter{Defense strategies when using the firewall}

\section{Untrust certificates}

Even if CAs (certificate authorities) do not want to do evil, their private key could still have been stolen. Thus, none of them are trustworthy. However, whole SSL is based on it, if we trust none of those authorities, there will be almost no website we can use and things will be worse if without SSL. When trying to decide which certificates to untrust, people could at first consider the CAs of the place you living in, the CAs of the place you come from, and their enemies and allies. SSL-pinning can prevent MITM attacks from a trusted CA when the user know the remote endpoint should use the certificate from another authority. However, configuring SSL-pinning to all the websites they use is hard and time consuming to average users and if they do not have a basic trusted environment, they cannot be certain whether they are doing it correctly. Even if they have done it correctly, it is still not strange for a website to switch to another CA. Thus, this can only be used in very limited circumstances. SSL-pinning can be configured to the proxy when needed.

\chapter[Short title]{A chapter title which will run over two lines --- it's for
  testing purpose}

\section{The first section}

 \section{The second, math section}

\textbf{Theorem 1 (Residue Theorem).}
Let $f$ be analytic in the region $G$ except for the isolated singularities $a_1,a_2,\ldots,a_m$. If $\gamma$ is a closed rectifiable curve in $G$ which does not pass through any of the points $a_k$ and if $\gamma\approx 0$ in $G$ then
\[
\frac{1}{2\pi i}\int_\gamma f = \sum_{k=1}^m n(\gamma;a_k) \text{Res}(f;a_k).
\]
\textbf{Theorem 2 (Maximum Modulus).}
\emph{Let $G$ be a bounded open set in $\mathbb{C}$ and suppose that $f$ is a continuous function on $G^-$ which is analytic in $G$. Then}
\[
\max\{|f(z)|:z\in G^-\}=\max \{|f(z)|:z\in \partial G \}.
\]

\section[third]{A very very long section, titled ``The third section'', with
  a rather  short text alternative (third)}

  \texttt{Some Test}
\lstset{language=algebra,linewidth=0.95\linewidth,breaklines=true,numbers=left,
basicstyle=\ttfamily,numberstyle=\tiny,escapeinside={//*}{\^^M},
mathescape=true}
\begin{lstlisting}
import IntSpec, ItemSpec;

sort cart; //*\label{sort}

constructors //*\label{begin-sig}
create() $\longrightarrow$ cart;
insert(cart, item) $\longrightarrow$ cart;
observers
amount(cart) $\longrightarrow$ int;
transformers
delete(cart, item) $\longrightarrow$ cart; //*\label{end-sig}

axioms //*\label{begin-axioms}
forall c: cart, i, j: item 

amount(create()) $=$ 0; //*\label{begin-amount}
amount(insert(c,i)) $=$ amount(c) $+$ price(i); //*\label{end-amount}
delete(create(),i) $=$ create(); //*\label{begin-delete}
delete(insert(c,i),j) $=$
if (i =$\:$= j) c
else insert(delete(c,j),i); //*\label{end-axioms}
end
\end{lstlisting}

As you can easily see from the above listing \citet{bbggs:iet07}
define something weird based on the BPEL specification
\citep{bpelspec}.
\nocite{*}

\appendix %optional, use only if you have an appendix

\chapter{Some retarded material}
\section{It's over\dots}

\backmatter

\chapter{Glossary} %optional

%\bibliographystyle{alpha}
%\bibliographystyle{dcu}
\bibliographystyle{plainnat}
\bibliography{biblio}

%\cleardoublepage
%\theindex %optional, use only if you have an index, must use
	  %\makeindex in the preamble
%\lipsum
1
\end{document}
\grid
